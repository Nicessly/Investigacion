"""
Ejemplo sencillo de Filtrado Colaborativo con Factorización Matricial (SGD)
Este script genera una pequeña matriz de valoraciones de ejemplo y aplica un modelo de factorización para predecir valores faltantes.
"""

import numpy as np
import pandas as pd

# Datos de ejemplo (usuarios x ítems)
# 0 significa que el usuario no ha valorado el ítem
R = np.array([
    [5, 3, 0, 1],
    [4, 0, 0, 1],
    [1, 1, 0, 5],
    [0, 0, 5, 4],
    [0, 1, 5, 4]
], dtype=float)

# Parámetros
num_users, num_items = R.shape
k = 2          # Número de factores latentes
alpha = 0.01   # Tasa de aprendizaje
beta = 0.02    # Regularización

# Inicialización aleatoria de matrices P y Q
P = np.random.rand(num_users, k)
Q = np.random.rand(num_items, k)

# SGD simple
for epoch in range(5000):
    for u in range(num_users):
        for i in range(num_items):
            if R[u, i] > 0:
                pred = np.dot(P[u, :], Q[i, :].T)
                error = R[u, i] - pred
                # Actualización
                P[u, :] += alpha * (error * Q[i, :] - beta * P[u, :])
                Q[i, :] += alpha * (error * P[u, :] - beta * Q[i, :])

# Matriz reconstruida
R_pred = np.dot(P, Q.T)

# Mostrar resultados
print("Matriz original (0 = no valorado):")
print(pd.DataFrame(R))

print("\nMatriz predicha:")
print(pd.DataFrame(np.round(R_pred, 2)))
